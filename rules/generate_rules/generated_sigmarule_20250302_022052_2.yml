title: Obfuscated Execution of CertUtil.exe for File Downloading
id: f6e5d4c3-b2a1-0987-6fed-cba987654321
description: |
  Detects the execution of certutil.exe with obfuscated command-line arguments that may indicate an attempt to evade detection while downloading or decoding malicious files. This includes patterns with inserted non-alphanumeric characters and quotes.
author: Yusuke Nakajima
date: 2025-03-02
tags:
  - attack.execution
  - attack.defense_evasion
  - attack.t1202
logsource:
  product: windows
  category: process_creation
detection:
  selection_obfuscated_certutil:
    Image|endswith:
      - '\\certutil.exe'
      - '\\CertUtil.exe'
    CommandLine|re:
      - '(?i)certutil.*["'']?h[^a-zA-Z0-9]*t[^a-zA-Z0-9]*t[^a-zA-Z0-9]*p[^a-zA-Z0-9]*s?[:/\\\\]+www\.example\.org[/\\\\]+home\.txt'
      - '(?i)certutil.*["'']?f[^a-zA-Z0-9]*/[^a-zA-Z0-9]*urlcache.*["'']?https?://www\.example\.org/.*\.txt'
  condition: selection_obfuscated_certutil
falsepositives:
  - Legitimate usage of certutil with encoded URLs by system administrators
level: high
