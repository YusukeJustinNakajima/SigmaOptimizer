title: Suspicious CertUtil.exe Download Command with Obfuscation
id: d4f5e6a7-b8c9-4d2e-9f1a-2b3c4d5e6f7g
description: |
  Detects the execution of certutil.exe with URL-based download commands, including common obfuscation techniques used to bypass simple detections.
author: Yusuke Nakajima
date: 2025-03-02
tags:
  - attack.execution
  - attack.defense_evasion
  - attack.t1203
logsource:
  category: process_creation
  product: windows
detection:
  selection_certutil:
    OriginalFileName|contains:
      - 'certutil.exe'
  selection_cmd:
    CommandLine|contains|all:
      - '/urlcache'
      - 'https://'
  selection_re:
    CommandLine|re:
      - '(?i)c[^a-zA-Z0-9]*e[^a-zA-Z0-9]*r[^a-zA-Z0-9]*t[^a-zA-Z0-9]*u[^a-zA-Z0-9]*t[^a-zA-Z0-9]*i[^a-zA-Z0-9]*l'
      - '(?i)h[^a-zA-Z0-9]*t[^a-zA-Z0-9]*t[^a-zA-Z0-9]*p[^a-zA-Z0-9]*s?:[^a-zA-Z0-9]*//'
  condition: selection_certutil and (selection_cmd or selection_re)
falsepositives:
  - Legitimate use of certutil.exe for certificate management or other administrative tasks.
level: high
