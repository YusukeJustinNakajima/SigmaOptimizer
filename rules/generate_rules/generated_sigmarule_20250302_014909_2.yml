title: Detection of 'whoami' Command Execution from Unusual Parent Processes
id: f0e1d2c3-b4a5-6789-0fed-cba987654321
description: |
    Detects the execution of the 'whoami' command originating from parent processes not typically associated with administrative tasks.
    This may indicate malicious activity attempting user enumeration from atypical sources.
author: Yusuke Nakajima
date: 2025-03-02
tags:
  - attack.execution
  - attack.discovery
logsource:
  category: process_creation
  product: windows
detection:
  selection_suspicious_parent:
    Image|endswith: '\whoami.exe'
    ParentImage|ni|endswith:
      - '\cmd.exe'
      - '\powershell.exe'
      - '\explorer.exe'
      - '\services.exe'
      - '\svchost.exe'
    ParentUser|not in:
      - 'SYSTEM'
      - 'Administrators'
      - 'TrustedInstaller'
  condition: selection_suspicious_parent
falsepositives:
  - Legitimate 'whoami.exe' executions from trusted administrative processes not listed.
  - Custom scripts or applications performing user enumeration.
level: medium
